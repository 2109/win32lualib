<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>OOLua: Lua Types in OOLua</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="OOLua.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OOLua
   &#160;<span id="projectnumber">2.0.0.beta3</span>
   </div>
   <div id="projectbrief">C++ and Lua binding</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_lua_types_in_o_o_lua.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Lua Types in OOLua </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>OOLua has three types to help interact with Lua types</p>
<h1><a class="anchor" id="OOLuaTypesRef"></a>
Lua_ref</h1>
<p>The Lua_ref templated class stores a reference using Lua's reference system luaL_ref and luaL_unref, along with a <a class="el" href="structlua___state.html" title="Lua virtual machine. ">lua_State</a>. The reason this class stores the <a class="el" href="structlua___state.html" title="Lua virtual machine. ">lua_State</a> is to make it difficult to use the reference with another universe. A reference from the same Lua universe, even if it is from a different <a class="el" href="structlua___state.html" title="Lua virtual machine. ">lua_State</a>, is valid to be used in the universe. </p>
<p>The class takes ownership of any reference passed either to the <a class="el" href="struct_o_o_l_u_a_1_1_lua__ref.html#aa4c0dd0707bfadc4f140a7933af7d0de">two argument constructor</a> or the <a class="el" href="struct_o_o_l_u_a_1_1_lua__ref.html#acba6ea2142cc03bbaca0debe5359802b">set_ref</a> function. On going out of scope a <a class="el" href="struct_o_o_l_u_a_1_1_lua__ref.html#ae9259d8f63f4d3a7f9343c771eb7ae71">valid</a> reference is guaranteed to be released, you may also force a release by passing an instance to <a class="el" href="struct_o_o_l_u_a_1_1_lua__ref.html#a959ef76cd6d1dc736757ce753a13db37">swap</a> for which <a class="el" href="struct_o_o_l_u_a_1_1_lua__ref.html#ae9259d8f63f4d3a7f9343c771eb7ae71">valid</a> returns false. </p>
<p>There are two special values for the reference which Lua provides, both of which OOLua will treat as an invalid reference: </p>
<ul>
<li>LUA_REFNIL luaL_ref return value to indicate it encountered a nil object at the location the ref was asked for </li>
<li>LUA_NOREF guaranteed to be different from any reference return by luaL_ref <dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">ID</td><td>Lua type as returned by lua_type </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd></dd></dl>
</li>
<li>Universe: A call to luaL_newstate or lua_newstate creates a Lua universe and a universe is completely independent of any other universe. lua_newthread and coroutine.create, create a <a class="el" href="structlua___state.html" title="Lua virtual machine. ">lua_State</a> in an already existing universe.<br/>
 Term first heard in a Lua mailing list post by Mark Hamburg. </li>
</ul>
<p>For your convenience there are two predefined typedefs: </p>
<ul>
<li><a class="el" href="namespace_o_o_l_u_a.html#a4799d6fa6b94c3eb857e0bcbb1ea381f">OOLUA::Lua_func_ref</a> <div class="fragment"><div class="line">    <span class="keywordtype">void</span> pullLuaFunction_luaFunctionOnStack_functionIsValid()</div>
<div class="line">    {</div>
<div class="line">        lua_pushcclosure(*m_lua, lua_gettop, 0);</div>
<div class="line">        <a class="code" href="struct_o_o_l_u_a_1_1_lua__ref.html" title="A typed wrapper for a Lua reference. ">OOLUA::Lua_func_ref</a> lua_func;</div>
<div class="line">        <a class="code" href="namespace_o_o_l_u_a.html#a16e0b11358d3e36facfdf294eab8f1b7" title="Pulls the top element off the stack and pops it. ">OOLUA::pull</a>(*m_lua, lua_func);</div>
<div class="line">        CPPUNIT_ASSERT_EQUAL(<span class="keyword">true</span>, lua_func.<a class="code" href="struct_o_o_l_u_a_1_1_lua__ref.html#ae9259d8f63f4d3a7f9343c771eb7ae71" title="Returns true if both the Lua instance is not NULL and the registry reference is not invalid...">valid</a>());</div>
<div class="line">    }</div>
</div><!-- fragment --> </li>
<li><a class="el" href="namespace_o_o_l_u_a.html#acb779ad0b57f8ce1605c323837408a9e">OOLUA::Lua_table_ref</a> <div class="fragment"><div class="line">    <span class="keywordtype">void</span> pullTableRef_validTableOnStack_tableIsValid()</div>
<div class="line">    {</div>
<div class="line">        lua_createtable(*m_lua, 0, 0);</div>
<div class="line">        <a class="code" href="struct_o_o_l_u_a_1_1_lua__ref.html">OOLUA::Lua_table_ref</a> table;</div>
<div class="line">        <a class="code" href="namespace_o_o_l_u_a.html#a16e0b11358d3e36facfdf294eab8f1b7" title="Pulls the top element off the stack and pops it. ">OOLUA::pull</a>(*m_lua, table);</div>
<div class="line">        CPPUNIT_ASSERT_EQUAL(<span class="keyword">true</span>, table.<a class="code" href="struct_o_o_l_u_a_1_1_lua__ref.html#ae9259d8f63f4d3a7f9343c771eb7ae71" title="Returns true if both the Lua instance is not NULL and the registry reference is not invalid...">valid</a>());</div>
<div class="line">    }</div>
</div><!-- fragment --> </li>
</ul>
<h1><a class="anchor" id="OOLuaTypesFunction"></a>
Lua_function</h1>
<p><a class="el" href="struct_o_o_l_u_a_1_1_lua__function.html">Lua_function</a> is a <a class="el" href="structlua___state.html" title="Lua virtual machine. ">lua_State</a> function caller object, the state in which it calls a function is specified in either the <a class="el" href="struct_o_o_l_u_a_1_1_lua__function.html#a27178206f5470c7f86eb353c5c5eed00">constructor</a> or via <a class="el" href="struct_o_o_l_u_a_1_1_lua__function.html#a498c7a7105b2a1461bce42f97d2670f4">bind_script</a>. This object provides function call operator overloads up to <a class="el" href="group___o_o_lua_file_generation.html#OOLuaConfigLuaParams">"lua_params"</a> count + 1 parameters, the first of which being the function which is to be called and it's type maybe one of: </p>
<ul>
<li>std::string A function in Lua's global table </li>
<li><a class="el" href="namespace_o_o_l_u_a.html#a4799d6fa6b94c3eb857e0bcbb1ea381f">OOLUA::Lua_func_ref</a> A reference to a function </li>
<li>int A valid stack index </li>
</ul>
<h2><a class="anchor" id="CallingALuaFunction"></a>
Calling a Lua function</h2>
<p>A Lua function can be called using the function object <a class="el" href="struct_o_o_l_u_a_1_1_lua__function.html">OOLUA::Lua_function</a> of which there is an instance bound in the constructor for Script <a class="el" href="class_o_o_l_u_a_1_1_script.html#aeb72eac1a7a2ca5f9d4292e5a7fe7623">OOLUA::Script::call</a>. <a class="el" href="struct_o_o_l_u_a_1_1_lua__function.html">OOLUA::Lua_function</a> has overloaded function call operators which take upto the maximum defined by <a class="el" href="group___o_o_lua_file_generation.html#OOLuaConfigLuaParams">"lua_params"</a>.<br/>
</p>
<p>Name: </p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> stringFunc_callsFunctionInGlobalScope_returnsTrue()</div>
<div class="line">    {</div>
<div class="line">        m_lua-&gt;<a class="code" href="class_o_o_l_u_a_1_1_script.html#a90a3d026d4e00bca54c59280e38557d9" title="Helper function. ">run_chunk</a>(<span class="stringliteral">&quot;_G[&#39;global_name&#39;] = function() end&quot;</span>);</div>
<div class="line">        <a class="code" href="struct_o_o_l_u_a_1_1_lua__function.html" title="Structure which is used to call a Lua function. ">OOLUA::Lua_function</a> caller(*m_lua);</div>
<div class="line">        CPPUNIT_ASSERT_EQUAL(<span class="keyword">true</span> , caller(<span class="stringliteral">&quot;global_name&quot;</span>));</div>
<div class="line">    }</div>
</div><!-- fragment --><p> Lua_func_ref: </p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> functionRef_functionRefIsFromAChildState_returnsTrue()</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">using namespace </span>OOLUA; <span class="comment">//NOLINT(build/namespaces)</span></div>
<div class="line">        <a class="code" href="struct_o_o_l_u_a_1_1_lua__ref.html" title="A typed wrapper for a Lua reference. ">Lua_func_ref</a> func_from_child = create_func_ref_with_child_state();</div>
<div class="line">        <a class="code" href="struct_o_o_l_u_a_1_1_lua__function.html" title="Structure which is used to call a Lua function. ">Lua_function</a> caller(*m_lua);</div>
<div class="line">        CPPUNIT_ASSERT_EQUAL(<span class="keyword">true</span>, caller(func_from_child) );</div>
<div class="line">    }</div>
</div><!-- fragment --><p> Valid stack index </p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> indexFunc_passedFunctionIndex_returnsTrue()</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="struct_o_o_l_u_a_1_1_lua__function.html" title="Structure which is used to call a Lua function. ">OOLUA::Lua_function</a> caller(*m_lua);</div>
<div class="line">        m_lua-&gt;<a class="code" href="class_o_o_l_u_a_1_1_script.html#a957c72f32c8bcfb4944f282cc27fb155" title="Helper function. ">load_chunk</a>(<span class="stringliteral">&quot;return&quot;</span>);</div>
<div class="line">        CPPUNIT_ASSERT_EQUAL(<span class="keyword">true</span>, caller(1));</div>
<div class="line">    }</div>
</div><!-- fragment --> <h1><a class="anchor" id="OOLuaTypesTable"></a>
Table</h1>
<p><a class="el" href="class_o_o_l_u_a_1_1_table.html">Table</a> provides a simple typed C++ interface for the Lua unordered and ordered associative container of the same name. Operations which use the Lua stack ensure that the stack is the same on exit as it was on entry, OOLua tries to force a clean stack(<a class="el" href="_o_o_lua_first_look.html#OOLuaAndTheStack">OOLua and the Lua stack</a>).</p>
<p>Any value can be retrieved or set from the table via the use of the template member functions <a class="el" href="class_o_o_l_u_a_1_1_table.html#ae6fbc0d59ba43f6cd4daa1e52a544190">set</a>, <a class="el" href="class_o_o_l_u_a_1_1_table.html#a015ad7c4e39f74cd9ce37a4c3a4d1a84">at</a> or <a class="el" href="class_o_o_l_u_a_1_1_table.html#a6f28046b8d28985eafe6e6667d39eb14">safe_at</a>. If the value asked for is not the correct type located in the position an error can be reported, the type of which depends on <a class="el" href="group___o_o_lua_error_reporting.html">Error Reporting</a> and the function which was called. See individual member function documentation for details.</p>
<dl class="section note"><dt>Note</dt><dd>The member function <a class="el" href="class_o_o_l_u_a_1_1_table.html#a9dccb400bd451a213405a786647c62ad">try_at</a> is only defined when exceptions are enabled for the library. </dd></dl>
<p>There are two helper functions for creating a <a class="el" href="class_o_o_l_u_a_1_1_table.html">OOLUA::Table</a> both of which are named <a class="el" href="namespace_o_o_l_u_a.html#a8e0504b5a0f9dbbd05417e657c0439f4">OOLUA::new_table</a>. </p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> setValue_valueSetInLua_cppSideRepresentationHasChange()</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="class_o_o_l_u_a_1_1_table.html" title="Wrapper around a table in Lua which allows easy usage. ">OOLUA::Table</a> t;</div>
<div class="line">        <a class="code" href="namespace_o_o_l_u_a.html#a8e0504b5a0f9dbbd05417e657c0439f4" title="Creates a new valid OOLUA::Table. ">OOLUA::new_table</a>(*m_lua, t);</div>
<div class="line"></div>
<div class="line">        m_lua-&gt;<a class="code" href="class_o_o_l_u_a_1_1_script.html#a90a3d026d4e00bca54c59280e38557d9" title="Helper function. ">run_chunk</a>(<span class="stringliteral">&quot;func = function(t) t[&#39;a&#39;] = 1; end&quot;</span>);</div>
<div class="line">        m_lua-&gt;<a class="code" href="class_o_o_l_u_a_1_1_script.html#aeb72eac1a7a2ca5f9d4292e5a7fe7623">call</a>(<span class="stringliteral">&quot;func&quot;</span>, t);</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> storedValue(0);</div>
<div class="line">        t.<a class="code" href="class_o_o_l_u_a_1_1_table.html#a015ad7c4e39f74cd9ce37a4c3a4d1a84">at</a>(<span class="stringliteral">&quot;a&quot;</span>, storedValue);</div>
<div class="line">        CPPUNIT_ASSERT_EQUAL(1, storedValue);</div>
<div class="line">    }</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="_o_o_lua_useage.html">Usage</a></li>
    <li class="footer">Generated on Sun Oct 27 2013 14:01:54 for OOLua by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
