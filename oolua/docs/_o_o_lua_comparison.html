<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>OOLua: Library Comparisons</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="OOLua.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OOLua
   &#160;<span id="projectnumber">2.0.0.beta3</span>
   </div>
   <div id="projectbrief">C++ and Lua binding</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_o_o_lua_comparison.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Library Comparisons </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="ComparisonIntroduction"></a>
Introduction</h1>
<p>The intention of the comparison is to give both you and I some ball park costs and were orginally based on a Gem <a class="el" href="_o_o_lua_comparison.html#GPG6_bib">[1]</a>; an excellent side effect from the libraries compared, other than SWIG, is that they have seen an optimisation improvement as a result. <br/>
 Previous versions of these comparsions were perceived by some difficult to fully understand what a number meant in relation to others, without also understanding some of the differences between libraries; additionly there was a concern that the cost of the method look up should not be part of the comparison.</p>
<h2><a class="anchor" id="ComparisonUD"></a>
Userdata verification</h2>
<p>Although the comparisons ran the same code when being timed, it was not simply a case of a one to one mapping between the different libraries.Most concerning to some was the fact that as a library feature LuaBind verified a userdata was created by itself whilst SWIG and originally OOLua did not perform such a check, thus OOLua and SWIG benefited whilst LuaBind was penalised. </p>
<p>Depending on your requirements SWIG, OOLua and LuaBind can all be compiled so that they do not perform these userdata checks, the potential problem this introduces can be shown with the following Lua 5.1 snippets: </p>
<div class="fragment"><div class="line">--Calling a member <span class="keyword">function</span> passing a none library userdata</div>
<div class="line">local cached_func = obj.func</div>
<div class="line">cached_func( newproxy() )</div>
</div><!-- fragment --><p> or </p>
<div class="fragment"><div class="line">--Passing a none library userdata when one is needed</div>
<div class="line">obj:func( newproxy() )</div>
</div><!-- fragment --> <p>When an incorrect userdata is encountered which maybe from an external module or from a Lua script such as in the examples; then best case scenario is the library will detect it, yet in the process could cause undefined behaviour, and worst case maybe a segfault or your toaster runs off with the next door neighbour's. </p>
<p>To compile OOLua and LuaBind to use the same behaviour as SWIG </p>
<ul>
<li>OOLua: define OOLUA_CHECK_EVERY_USERDATA_IS_CREATED_BY_OOLUA 0 </li>
<li>LuaBind: define LUABIND_DISABLE_UD_CHECK and add the following macro guard to object_rep.cpp <div class="fragment"><div class="line">    LUABIND_API object_rep* get_instance(<a class="code" href="structlua___state.html" title="Lua virtual machine. ">lua_State</a>* L, <span class="keywordtype">int</span> index)</div>
<div class="line">    {</div>
<div class="line">        object_rep* result = <span class="keyword">static_cast&lt;</span>object_rep*<span class="keyword">&gt;</span>(lua_touserdata(L, index));</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef LUABIND_DISABLE_UD_CHECK</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (!result || !lua_getmetatable(L, index))</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">        lua_rawgeti(L, -1, 1);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (lua_tocfunction(L, -1) != &amp;get_instance_value)</div>
<div class="line">            result = 0;</div>
<div class="line"></div>
<div class="line">        lua_pop(L, 2);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">return</span> result;</div>
<div class="line">    }</div>
</div><!-- fragment --></li>
</ul>
<p>For this reason the comparisons are performed for libraries with this feature enabled and disabled where possible, otherwise the category a library falls into by default.</p>
<dl class="section note"><dt>Note</dt><dd>It is my belief that a determined party could possibly craft malicous code that will pass most library userdata checks, as essentially they all boil down to doing a check and if it passes then casting a void pointer to a type, some actually perform an undefined cast before any such check passes.<a class="el" href="_o_o_lua_comparison.html#Cpp03CastRef">[2]</a></dd></dl>
<h2><a class="anchor" id="ComparisonCaching"></a>
Function caching</h2>
<p>A Lua self call self:func() is functionally the same as self.func(self), it is also normal and recommeded usage in certain situations to cache values to locals. The comparison code is run in such a formentioned situation with tight loops, so if it were normal user code you would generally cache the member function as shown in the following example. Otherwise it would repeatively pay for the function look up when the object types are the same, whilst that is a valid concern my observed usage of C++ binding libraries is via an object call hence OOLua.</p>
<div class="fragment"><div class="line">    ,mfunc_cached = <span class="keyword">function</span>(object)</div>
<div class="line">        local ave = 0</div>
<div class="line">        local func = <span class="keywordtype">object</span>.<span class="keyword">get</span></div>
<div class="line">        <span class="keywordflow">for</span> i = 0, N <span class="keywordflow">do</span></div>
<div class="line">            local t0 = clock()</div>
<div class="line">            <span class="keywordflow">for</span> i=1,times <span class="keywordflow">do</span></div>
<div class="line">                func(<span class="keywordtype">object</span>)</div>
<div class="line">            end</div>
<div class="line">            local dt = clock()-t0</div>
<div class="line">            if i~=0 then</div>
<div class="line">            ave = ave + dt</div>
<div class="line">            end</div>
<div class="line">        end</div>
<div class="line">        return (ave/N)/times</div>
<div class="line">    end</div>
</div><!-- fragment --><p> For this reason the comparisons are performed for libraries both with caching function and self calls. <br/>
 </p>
<ul>
<li><a class="el" href="_o_o_lua_comparison_test_code.html">Comparison code</a> </li>
<li><a class="el" href="_o_o_lua_library_comparison_results.html">Comparison results</a> </li>
<li><a class="el" href="_library_comparison_overview.html">Comparison overview</a></li>
</ul>
<dl class="section user"><dt></dt><dd><a class="anchor" id="GPG6_bib"></a> [1] GPG6 Celes, W., Figueiredo, L.H. and Ierusalimschy, R., "Binding C/C++ Objects to Lua." Game Programming Gems 6, Charles River Media, 2006. </dd></dl>
<dl class="section user"><dt></dt><dd><a class="anchor" id="Cpp03CastRef"></a> [2] Programming languages C++, ISO/IEC 14882:2003, "5.2.9 static_cast", American National Standards Institute, 2003 </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Oct 27 2013 14:01:54 for OOLua by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
